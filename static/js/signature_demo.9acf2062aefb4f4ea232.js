webpackJsonp([4],{100:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function r(e,t){return Math.atan2(t.x-e.x,t.y-e.y)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(43),u=a(o),c=n(44),s=a(c),l=n(45),_=a(l),d=n(47),f=a(d),g=n(46),h=a(g),p=n(15),m=a(p),v=n(91),w=a(v),S=(n(90),n(114)),y=a(S),b=(w.default.bind(y.default),function(e){function t(){(0,s.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return e._creatCanvas=function(){var t=e.props.area_proportion,n=window.innerWidth/window.innerHeight;n>1?n>t?(console.log("land max height"),e.setState({canvas:{width:window.innerHeight*t,height:window.innerHeight}})):(console.log("land max width"),e.setState({canvas:{width:window.innerWidth,height:window.innerWidth/t}})):n>t?(console.log("port max height"),e.setState({canvas:{width:window.innerWidth,height:window.innerWidth*t}})):(console.log("port max width"),e.setState({canvas:{width:window.innerHeight/t,height:window.innerHeight}}));var a=e.refCanvasSignature;e.ctx=a.getContext("2d"),e.ctx.lineJoin=e.ctx.lineCap="round"},e._drawStartSignature=function(t){t.preventDefault(),e.isDrawing=!0,e.lastPoint={x:t.touches[0].clientX-e.refCanvasSignature.offsetLeft,y:t.touches[0].clientY-e.refCanvasSignature.offsetTop}},e._drawMoveSignature=function(t){if(e.isDrawing){for(var n={x:t.touches[0].clientX-e.refCanvasSignature.offsetLeft,y:t.touches[0].clientY-e.refCanvasSignature.offsetTop},a=i(e.lastPoint,n),o=r(e.lastPoint,n),u=t.touches[0].force,c=0;c<a;c++){var s=e.lastPoint.x+Math.sin(o)*c,l=e.lastPoint.y+Math.cos(o)*c,_=e.ctx.createRadialGradient(s,l,0,s,l,e.rectSize/3*(u+.05));_.addColorStop(0,"#000"),_.addColorStop(.3,"rgba(0,0,0,0.5)"),_.addColorStop(1,"rgba(0,0,0,0)"),e.ctx.fillStyle=_,e.ctx.fillRect(s-e.rectSize/2,l-e.rectSize/2,e.rectSize,e.rectSize)}e.lastPoint=n}},e._drawEndSignature=function(){e.isDrawing=!1},e._getScaleOrigin=function(){var t=document.getElementById(e.props.dom_signature_id);e.setState({transformOrigin:t.offsetLeft+t.clientWidth/2+"px "+(t.offsetTop+t.clientHeight/2)+"px"})},e._cleanSignature=function(){var t=e.refCanvasSignature;console.log(t),e.ctx.clearRect(0,0,t.width,t.height)},e._completeSignature=function(){var t=e.props.closeSignature,n=e.refCanvasSignature.toDataURL();if(window.innerWidth/window.innerHeight<1){var a=new Image;a.onload=function(){var e=a.width,i=a.height,r=document.createElement("canvas"),o=r.getContext("2d");r.width=i,r.height=e,o.transform(0,-1,1,0,0,e),o.drawImage(a,0,0),n=r.toDataURL(),t(n)},a.src=n}else t(n)},e.state={transformOrigin:!1,canvas:{height:!1,width:!1}},e.isDrawing=!1,e.lastPoint=!1,e.ctx=!1,e.rectSize=60,e}return(0,h.default)(t,e),(0,_.default)(t,[{key:"componentWillMount",value:function(){this._getScaleOrigin()}},{key:"componentDidMount",value:function(){var e=this;this._creatCanvas(),window.addEventListener("resize",function(){e._cleanSignature(),setTimeout(e._creatCanvas,0)})}},{key:"componentDidUpdate",value:function(e,t){}},{key:"render",value:function(){var e=this,t=this.state,n=t.transformOrigin,a=t.canvas,i=this.props,r=i.signature_open,o=(i.closeSignature,i.area_proportion);return console.log(a),m.default.createElement("div",{className:y.default.container+(0,w.default)({" active":r}),style:{transformOrigin:n}},o&&m.default.createElement("canvas",{ref:function(t){return e.refCanvasSignature=t},width:a.width,height:a.height,onTouchStart:this._drawStartSignature,onTouchMove:this._drawMoveSignature,onTouchEnd:this._drawEndSignature}),m.default.createElement("div",{className:y.default.box__btns},m.default.createElement("div",{className:y.default.btn__signatureClean,onClick:this._cleanSignature},m.default.createElement("i",{className:"fa fa-eraser","aria-hidden":"true"})),m.default.createElement("div",{className:y.default.btn__signatureDone,onClick:this._completeSignature},m.default.createElement("i",{className:"fa fa-check","aria-hidden":"true"}))))}}]),t}(p.PureComponent));b.propTypes={dom_signature_id:p.PropTypes.string.isRequired,signature_open:p.PropTypes.bool.isRequired,closeSignature:p.PropTypes.func.isRequired,area_proportion:p.PropTypes.number},t.default=b},101:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(43),r=a(i),o=n(44),u=a(o),c=n(45),s=a(c),l=n(47),_=a(l),d=n(46),f=a(d),g=n(15),h=a(g),p=n(116),m=a(p),v=n(90),w=n(102),S=a(w),y=void 0,b=void 0,x=void 0,C=void 0,E=void 0,M=function(e){function t(){return(0,u.default)(this,t),(0,_.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,f.default)(t,e),(0,s.default)(t,[{key:"componentWillMount",value:function(){y=window.innerWidth,b=window.innerHeight,x=y/2,C=y/2-x/2,E=.25*b}},{key:"componentDidMount",value:function(){(0,S.default)(this.refCircleLight,this.refTitle),console.log(this)}},{key:"componentWillLeave",value:function(e){v.TweenMax.to(this.refContainer,.5,{opacity:0,onComplete:e})}},{key:"render",value:function(){var e=this,t=this.props.cbHintDone;return h.default.createElement("div",{ref:function(t){return e.refContainer=t},className:m.default.container,onClick:t},h.default.createElement("h1",{ref:function(t){return e.refTitle=t}},"吉時保線上簽核"),h.default.createElement("svg",{viewBox:"0 0 "+y+" "+b},h.default.createElement("defs",null,h.default.createElement("mask",{id:"clip_hint"},h.default.createElement("rect",{width:"100%",height:"100%",fill:"white"}),h.default.createElement("circle",{className:"svg__hintCircle",ref:function(t){return e.refCircleLight=t},cx:.5*y,cy:.5*-b,r:"0",fill:"black"}))),h.default.createElement("rect",{className:m.default.svg__bg,x:"0",y:"0",width:window.innerWidth,height:window.innerHeight,mask:"url(#clip_hint)"}),h.default.createElement("image",{x:C,y:E,width:.5*y,className:m.default.svg__logo,href:n(125)})))}}]),t}(g.PureComponent);M.propTypes={cbHintDone:g.PropTypes.func.isRequired},t.default=M},102:function(e,t,n){"use strict";function a(e,t){var n=new i.TimelineLite,a=window.innerWidth,r=window.innerHeight;n.to(e,1,{attr:{r:.35*a,cy:.4*r},ease:i.Power2.easeOut}).to(e,1,{attr:{cy:.8*r,r:.3*a},delay:1}).to(e,1,{transformOrigin:"center center",skewX:40,rotation:-25,attr:{r:.3*a}}).to(t,1,{opacity:1,ease:i.Power2.easeOut})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var i=n(90)},106:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var i=n(15),r=a(i),o=n(42),u=n(96),c=a(u);(0,o.render)(r.default.createElement(c.default,{img_contract:n(98)}),document.getElementById("app"))},114:function(e,t){e.exports={container:"Signature__container___NdjX7",box__btns:"Signature__box__btns___i4D80",btn__signatureDone:"Signature__btn__signatureDone___3Ckj0",btn__signatureClean:"Signature__btn__signatureClean___2g97P"}},115:function(e,t){e.exports={container:"SignatureContainer__container___2_x8m",box__contract:"SignatureContainer__box__contract___r9p2f","box__contract--hint":"SignatureContainer__box__contract--hint___3gIgl",img__contract:"SignatureContainer__img__contract___1HlBB",signature_position:"SignatureContainer__signature_position___2oE9H",signatureArea:"SignatureContainer__signatureArea___2Hbf0",signature_requirement:"SignatureContainer__signature_requirement___1vlnB",signature_requirement2:"SignatureContainer__signature_requirement2___2dEKV",btn__search:"SignatureContainer__btn__search___3h05D"}},116:function(e,t){e.exports={container:"SignatureHintMask__container___2KwXP",svg__bg:"SignatureHintMask__svg__bg___OjmQU",svg__logo:"SignatureHintMask__svg__logo___3VAwu",svg__hintCircle:"SignatureHintMask__svg__hintCircle___13LO4"}},125:function(e,t,n){e.exports=n.p+"static/img/logo_newa.c58150e.png"},15:function(e,t){e.exports=React},42:function(e,t){e.exports=ReactDOM},96:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(43),r=a(i),o=n(44),u=a(o),c=n(45),s=a(c),l=n(47),_=a(l),d=n(46),f=a(d),g=n(15),h=a(g),p=n(91),m=a(p),v=n(123),w=a(v),S=n(115),y=a(S),b=n(101),x=a(b),C=n(100),E=a(C),M=m.default.bind(y.default),k=function(e){function t(){var e,n,a,i;(0,u.default)(this,t);for(var o=arguments.length,c=Array(o),s=0;s<o;s++)c[s]=arguments[s];return n=a=(0,_.default)(this,(e=t.__proto__||(0,r.default)(t)).call.apply(e,[this].concat(c))),a.state={hintMaskDone:!1,signatureAreaOpen:!1,area_proportion:!1,imageSignature:!1,zoomIn:!1},a._getSignatureAreaProportion=function(){a.setState({area_proportion:a.refSignatureArea.clientWidth/a.refSignatureArea.clientHeight})},a._zoomOutViewSize=function(){var e=document.querySelector('meta[name="viewport"]');e&&(e.content="user-scalable=no")},a._releaseScalable=function(){document.querySelector('meta[name="viewport"]').content="width=1040"},a._cbHintDone=function(){a.setState({hintMaskDone:!0},function(){a._releaseScalable()})},a._openSignatureArea=function(){a._zoomOutViewSize(),a.setState({signatureAreaOpen:!0})},a._closeSignatureArea=function(e){a.setState({signatureAreaOpen:!1,imageSignature:e},function(){a._releaseScalable()})},i=n,(0,_.default)(a,i)}return(0,f.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){this._getSignatureAreaProportion();var e=document.querySelector('meta[name="viewport"]');document.body.addEventListener("gesturestart",function(){e.content="width=1040"},!1)}},{key:"render",value:function(){var e=this,t=this.props.img_contract,n=this.state,a=n.hintMaskDone,i=n.signatureAreaOpen,r=n.area_proportion,o=n.imageSignature;return h.default.createElement("div",{className:y.default.container},h.default.createElement("div",{className:M("box__contract",{"box__contract--hint":!a})},h.default.createElement("img",{src:t,className:y.default.img__contract,alt:""}),h.default.createElement("div",{id:"box__proposer",ref:function(t){return e.refSignatureArea=t},className:M("signature_position","signature_requirement",{active:o}),style:{backgroundImage:"url("+o+")"},onClick:this._openSignatureArea})),!!r&&h.default.createElement(E.default,{dom_signature_id:"box__proposer",signature_open:i,area_proportion:r,closeSignature:this._closeSignatureArea}),h.default.createElement(w.default,null,!a&&h.default.createElement(x.default,{cbHintDone:this._cbHintDone})),h.default.createElement("image",{src:o}))}}]),t}(g.PureComponent);k.propTypes={img_contract:g.PropTypes.string.isRequired},t.default=k},98:function(e,t,n){e.exports=n.p+"static/img/contract_hash.47e78d0.jpg"}},[106]);
//# sourceMappingURL=signature_demo.9acf2062aefb4f4ea232.js.map