webpackJsonp([4],{100:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function r(e,t){return Math.atan2(t.x-e.x,t.y-e.y)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(43),c=i(o),u=n(44),s=i(u),l=n(45),_=i(l),d=n(47),g=i(d),f=n(46),h=i(f),p=n(15),m=i(p),w=n(91),v=i(w),S=(n(90),n(115)),y=i(S),C=(v.default.bind(y.default),function(e){function t(){(0,s.default)(this,t);var e=(0,g.default)(this,(t.__proto__||(0,c.default)(t)).call(this));return e._creatCanvas=function(){var t=e.props.area_proportion,n=window.innerWidth/window.innerHeight;n>1?n>t?(console.log("land max height"),e.setState({canvas:{width:window.innerHeight*t,height:window.innerHeight}})):(console.log("land max width"),e.setState({canvas:{width:window.innerWidth,height:window.innerWidth/t}})):1/n>t?(console.log("port max width"),e.setState({canvas:{width:window.innerWidth,height:window.innerWidth*t}})):(console.log("port max height"),console.log(window.innerHeight),e.setState({canvas:{width:window.innerHeight/t,height:window.innerHeight}}));var i=e.refCanvasSignature;e.ctx=i.getContext("2d"),e.ctx.lineJoin=e.ctx.lineCap="round"},e._drawStartSignature=function(t){t.preventDefault(),e.isDrawing=!0,e.lastPoint={x:t.touches[0].clientX-e.refCanvasSignature.offsetLeft,y:t.touches[0].clientY-e.refCanvasSignature.offsetTop}},e._drawMoveSignature=function(t){if(e.isDrawing){for(var n={x:t.touches[0].clientX-e.refCanvasSignature.offsetLeft,y:t.touches[0].clientY-e.refCanvasSignature.offsetTop},i=a(e.lastPoint,n),o=r(e.lastPoint,n),c=t.touches[0].force,u=0;u<i;u++){var s=e.lastPoint.x+Math.sin(o)*u,l=e.lastPoint.y+Math.cos(o)*u,_=e.ctx.createRadialGradient(s,l,0,s,l,e.rectSize/3*(c+.05));_.addColorStop(0,"#000"),_.addColorStop(.3,"rgba(0,0,0,0.5)"),_.addColorStop(1,"rgba(0,0,0,0)"),e.ctx.fillStyle=_,e.ctx.fillRect(s-e.rectSize/2,l-e.rectSize/2,e.rectSize,e.rectSize)}e.lastPoint=n}},e._drawEndSignature=function(){e.isDrawing=!1,e.alreadySign=!0},e._getScaleOrigin=function(){var t=document.getElementById(e.props.dom_signature_id);e.setState({transformOrigin:t.offsetLeft+t.clientWidth/2+"px "+(t.offsetTop+t.clientHeight/2)+"px"})},e._cleanSignature=function(){var t=e.refCanvasSignature;e.ctx.clearRect(0,0,t.width,t.height),e.alreadySign=!1},e._completeSignature=function(){var t=e.props.closeSignature,n=e.refCanvasSignature.toDataURL();if(window.innerWidth/window.innerHeight<1){var i=new Image;i.onload=function(){var a=i.width,r=i.height,o=document.createElement("canvas"),c=o.getContext("2d");o.width=r,o.height=a,c.transform(0,-1,1,0,0,a),c.drawImage(i,0,0),n=o.toDataURL(),t(n,e.alreadySign)},i.src=n}else t(n,e.alreadySign)},e.state={transformOrigin:!1,canvas:{height:!1,width:!1}},e.isDrawing=!1,e.lastPoint=!1,e.ctx=!1,e.rectSize=60,e.alreadySign=!1,e}return(0,h.default)(t,e),(0,_.default)(t,[{key:"componentWillMount",value:function(){this._getScaleOrigin()}},{key:"componentWillUpdate",value:function(e,t){e.orientation!=this.props.orientation&&(this._cleanSignature(),this._creatCanvas())}},{key:"componentDidMount",value:function(){this._creatCanvas()}},{key:"render",value:function(){var e=this,t=this.state,n=t.transformOrigin,i=t.canvas,a=this.props,r=a.signature_open,o=(a.closeSignature,a.area_proportion);return m.default.createElement("div",{className:y.default.container+(0,v.default)({" active":r}),style:{transformOrigin:n}},o&&m.default.createElement("canvas",{ref:function(t){return e.refCanvasSignature=t},width:i.width,height:i.height-32,onTouchStart:this._drawStartSignature,onTouchMove:this._drawMoveSignature,onTouchEnd:this._drawEndSignature}),m.default.createElement("div",{className:y.default.box__btns},m.default.createElement("div",{className:y.default.btn__signatureClean,onClick:this._cleanSignature},m.default.createElement("i",{className:"fa fa-eraser","aria-hidden":"true"})),m.default.createElement("div",{className:y.default.btn__signatureDone,onClick:this._completeSignature},m.default.createElement("i",{className:"fa fa-check","aria-hidden":"true"}))))}}]),t}(p.PureComponent));C.propTypes={dom_signature_id:p.PropTypes.string.isRequired,signature_open:p.PropTypes.bool.isRequired,closeSignature:p.PropTypes.func.isRequired,area_proportion:p.PropTypes.number,orientation:p.PropTypes.string.isRequired},t.default=C},101:function(e,t,n){"use strict";function i(e){console.log("sent out"),console.log(e),console.log(e.clientHeight),(new a.TimelineLite).to(e,.3,{y:-e.clientHeight,ease:a.Power2.easeOut})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=n(90)},102:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(43),r=i(a),o=n(44),c=i(o),u=n(45),s=i(u),l=n(47),_=i(l),d=n(46),g=i(d),f=n(15),h=i(f),p=n(117),m=i(p),w=n(90),v=n(103),S=i(v),y=function(e){function t(){(0,c.default)(this,t);var e=(0,_.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e._viewportInit=function(){e.setState({vw:window.innerWidth,vh:window.innerHeight,logo_size:window.innerHeight/3,logo_x:window.innerWidth/2-window.innerHeight/6,logo_y:.2*window.innerHeight},e._startOpeningAnimation)},e._startOpeningAnimation=function(){window.innerHeight>window.innerWidth&&e.props.contractOnload&&(0,S.default)(e.refCircleLight,e.refTitle,e.props.id_contract)},e.state={vw:window.innerWidth,vh:window.innerHeight,logo_size:window.innerHeight/3,logo_x:window.innerWidth/2-window.innerHeight/6,logo_y:.2*window.innerHeight},e}return(0,g.default)(t,e),(0,s.default)(t,[{key:"componentWillUpdate",value:function(e,t){e.orientation!=this.props.orientation&&this._viewportInit()}},{key:"componentDidUpdate",value:function(e,t){"port"===this.props.orientation&&"land"==e.orientation&&this._startOpeningAnimation()}},{key:"componentDidMount",value:function(){var e=this;window.innerHeight>window.innerWidth&&setTimeout(function(){e._startOpeningAnimation()},1e3)}},{key:"componentWillLeave",value:function(e){w.TweenMax.to(this.refContainer,.5,{opacity:0,onComplete:e})}},{key:"render",value:function(){var e=this,t=this.props.cbHintDone,i=this.state,a=i.vw,r=i.vh,o=i.logo_size,c=i.logo_x,u=i.logo_y;return h.default.createElement("div",{ref:function(t){return e.refContainer=t},className:m.default.container,onClick:t},h.default.createElement("h1",{ref:function(t){return e.refTitle=t}},"吉時保線上簽核"),h.default.createElement("svg",{viewBox:"0 0 "+a+" "+r},h.default.createElement("defs",null,h.default.createElement("mask",{id:"clip_hint"},h.default.createElement("rect",{width:"100%",height:"100%",fill:"white"}),h.default.createElement("circle",{className:"svg__hintCircle",ref:function(t){return e.refCircleLight=t},cx:.5*a,cy:.5*-r,r:"0",fill:"black"}))),h.default.createElement("rect",{className:m.default.svg__bg,x:"0",y:"0",width:window.innerWidth,height:window.innerHeight,mask:"url(#clip_hint)"}),h.default.createElement("image",{x:c,y:u,width:o,height:o,className:m.default.svg__logo,xlinkHref:n(126)})))}}]),t}(f.PureComponent);y.propTypes={cbHintDone:f.PropTypes.func.isRequired,id_contract:f.PropTypes.string.isRequired,contractOnload:f.PropTypes.bool.isRequired,orientation:f.PropTypes.string.isRequired},t.default=y},103:function(e,t,n){"use strict";function i(e,t,n){var i=new a.TimelineLite,r=(document.getElementById(n),window.innerWidth),o=window.innerHeight;i.to(e,1,{force3D:!1,attr:{cy:.37*o,r:.22*o},ease:a.Power2.easeOut}).to(e,1,{force3D:!1,attr:{cy:16*(62.2+1.74)+.15*o,r:.3*r},delay:1}).to(e,1,{force3D:!1,transformOrigin:"center center",skewX:40,rotation:-25,attr:{r:.3*r}}).to(t,1,{opacity:1,ease:a.Power2.easeOut})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=n(90)},107:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var a=n(15),r=i(a),o=n(42),c=n(96),u=i(c);(0,o.render)(r.default.createElement(u.default,{img_contract:n(98)}),document.getElementById("app"))},115:function(e,t){e.exports={container:"Signature__container___NdjX7",box__btns:"Signature__box__btns___i4D80",btn__signatureDone:"Signature__btn__signatureDone___3Ckj0",btn__signatureClean:"Signature__btn__signatureClean___2g97P"}},116:function(e,t){e.exports={container:"SignatureContainer__container___2_x8m",box__contract:"SignatureContainer__box__contract___r9p2f","box__contract--hint":"SignatureContainer__box__contract--hint___3gIgl",img__contract:"SignatureContainer__img__contract___1HlBB",signature_position:"SignatureContainer__signature_position___2oE9H",signatureArea:"SignatureContainer__signatureArea___2Hbf0",signature_requirement:"SignatureContainer__signature_requirement___1vlnB",signature_requirement2:"SignatureContainer__signature_requirement2___2dEKV",btn__search:"SignatureContainer__btn__search___3h05D",btn__confirm:"SignatureContainer__btn__confirm___3sd8a"}},117:function(e,t){e.exports={container:"SignatureHintMask__container___2KwXP",svg__bg:"SignatureHintMask__svg__bg___OjmQU",svg__logo:"SignatureHintMask__svg__logo___3VAwu",svg__hintCircle:"SignatureHintMask__svg__hintCircle___13LO4"}},126:function(e,t,n){e.exports=n.p+"static/img/logo_newa.c58150e.png"},15:function(e,t){e.exports=React},42:function(e,t){e.exports=ReactDOM},96:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(43),r=i(a),o=n(44),c=i(o),u=n(45),s=i(u),l=n(47),_=i(l),d=n(46),g=i(d),f=n(15),h=i(f),p=n(91),m=i(p),w=n(124),v=i(w),S=n(116),y=i(S),C=n(102),b=i(C),x=n(100),H=i(x),E=n(101),O=i(E),k=m.default.bind(y.default),P=function(e){function t(){(0,c.default)(this,t);var e=(0,_.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e._getOrientation=function(){e.setState({orientation:window.innerHeight>window.innerWidth?"port":"land"})},e._getSignatureAreaProportion=function(){e.setState({area_proportion:e.refSignatureArea.clientWidth/e.refSignatureArea.clientHeight})},e._zoomOutViewSize=function(){var e=document.querySelector('meta[name="viewport"]');e&&(e.content="width=1041, user-scalable=no")},e._releaseScalable=function(){document.querySelector('meta[name="viewport"]').content="width=1040"},e._cbHintDone=function(){e.setState({hintMaskDone:!0},function(){e._releaseScalable()})},e._openSignatureArea=function(){e._zoomOutViewSize(),e.setState({signatureAreaOpen:!0})},e._closeSignatureArea=function(t,n){e.setState({signatureAreaOpen:!1,signatureComplete:n,imageSignature:t},function(){e._releaseScalable()})},e._completeSignature=function(t){e.setState({signatureComplete:t})},e._confirmContract=function(){(0,O.default)(e.refContract)},e._onloadImgContract=function(){e.setState({contractOnload:!0})},e.state={orientation:!1,hintMaskDone:!1,signatureAreaOpen:!1,signatureComplete:!1,area_proportion:!1,imageSignature:!1,zoomIn:!1,contractOnload:!1},e}return(0,g.default)(t,e),(0,s.default)(t,[{key:"componentDidMount",value:function(){var e=this;this._getSignatureAreaProportion();var t=document.querySelector('meta[name="viewport"]');document.body.addEventListener("gesturestart",function(){t.content="width=1040"},!1),window.addEventListener("resize",function(t){e._getOrientation()})}},{key:"render",value:function(){var e=this,t=this.props.img_contract,n=this.state,i=n.orientation,a=n.hintMaskDone,r=n.signatureAreaOpen,o=n.area_proportion,c=n.imageSignature,u=n.signatureComplete,s=n.contractOnload;return h.default.createElement("div",{className:k("container",{active:c})},h.default.createElement("div",{id:"box_contract",ref:function(t){return e.refContract=t},className:k("box__contract",{"box__contract--hint":!a})},h.default.createElement("img",{src:t,className:y.default.img__contract,onLoad:this._onloadImgContract,alt:"contract"}),h.default.createElement("div",{id:"signature_proposer",ref:function(t){return e.refSignatureArea=t},className:k("signature_position","signature_requirement",{active:c}),style:{backgroundImage:"url("+c+")"},onClick:this._openSignatureArea})),!!o&&h.default.createElement(H.default,{dom_signature_id:"signature_proposer",orientation:i,signature_open:r,area_proportion:o,closeSignature:this._closeSignatureArea}),h.default.createElement(v.default,null,!a&&h.default.createElement(b.default,{orientation:i,cbHintDone:this._cbHintDone,id_contract:"box_contract",contractOnload:s})),h.default.createElement("div",{className:k("btn__confirm",{active:u}),onClick:this._confirmContract},"確認送出"))}}]),t}(f.PureComponent);P.propTypes={img_contract:f.PropTypes.string.isRequired},t.default=P},98:function(e,t,n){e.exports=n.p+"static/img/contract_hash.47e78d0.jpg"}},[107]);
//# sourceMappingURL=signature_demo.5b7477703164a363759d.js.map